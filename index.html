<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Good Dictionary</title>
    <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
        font-family: 'Segoe UI', sans-serif;
        background: #0a0a2a;
        color: #e0f7fa;
        min-height: 100vh;
        padding: 20px;
    }
    .container {
        max-width: 1000px;
        margin: 0 auto;
        background: rgba(10,20,40,0.3);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        border: 1px solid rgba(79,195,247,0.3);
    }
    h1 {
        text-align: center;
        color: #4fc3f7;
        margin-bottom: 30px;
        font-size: 2.5em;
    }
    .loading-container {
        text-align: center;
        color: #4fc3f7;
        padding: 60px 0;
    }
    .loading-spinner {
        border: 4px solid rgba(79,195,247,0.3);
        border-top: 4px solid #4fc3f7;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
    }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .search-section {
        display: none;
    }
    #searchInput {
        width: 100%;
        padding: 15px 20px;
        font-size: 18px;
        border: none;
        border-radius: 25px;
        background: rgba(255,255,255,0.15);
        color: #e0f7fa;
        outline: none;
    }
    .search-info {
        display: flex;
        justify-content: space-between;
        color: #81d4fa;
        font-size: 14px;
        margin: 10px 0;
    }
    .results-container {
        max-height: 600px;
        overflow-y: auto;
        background: rgba(10,20,40,0.4);
        border-radius: 10px;
        padding: 15px;
    }
    .result-item {
        background: rgba(255,255,255,0.1);
        margin-bottom: 15px;
        padding: 20px;
        border-radius: 10px;
        border: 1px solid rgba(79,195,247,0.2);
    }
    .word-title {
        font-size: 24px;
        font-weight: bold;
        color: #81d4fa;
        margin-bottom: 10px;
        border-bottom: 2px solid #1976d2;
        padding-bottom: 5px;
    }
    .word-definition {
        font-size: 16px;
        line-height: 1.6;
        color: #b3e5fc;
        margin-top: 8px;
    }
    .no-results {
        text-align: center;
        color: #7ecfff;
        padding: 40px;
        font-style: italic;
    }
    .edit-controls {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }
    .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
    }
    .btn-web-search { background: #2196F3; color: white; }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 2px 6px rgba(0,0,0,0.2); }
</style>
</head>
<body>
    <div class="container">
        <h1>üìò Good Dictionary</h1>

        <div class="loading-container" id="loadingContainer">
            <div class="loading-spinner"></div>
            <div>Loading Dictionary1.json...</div>
        </div>

        <div class="search-section" id="searchSection">
            <input type="text" id="searchInput" placeholder="Search for words or definitions... (minimum 2 characters)" />
            <div class="search-info">
                <span id="searchStatus">Ready to search</span>
                <span id="wordCount">Total words: 0</span>
            </div>
            <div class="results-container" id="resultsContainer">
                <div class="no-results">Enter a search term to find words and definitions</div>
            </div>

            <div class="edit-controls">
                <button class="btn btn-web-search" onclick="researchWord()">üåç Research</button>
                <button class="btn btn-web-search" onclick="enrichWord()">üî¢ Enrich</button>
            </div>
        </div>
    </div>

    <script>
        let dictionary = {};
        let searchWorker = null;
        let lastQuery = '';

        document.addEventListener('DOMContentLoaded', () => {
            fetch('Dictionary1.json')
                .then(r => r.ok ? r.json() : Promise.reject('File not found'))
                .then(data => {
                    dictionary = data;

                    // Lightweight Web Worker
                    const workerCode = URL.createObjectURL(new Blob([`
                        let dict = {};
                        self.onmessage = function(e) {
                            if (e.data.type === 'SET') { dict = e.data.dict; return; }
                            if (e.data.type === 'SEARCH') {
                                const q = e.data.query.trim();
                                if (q.length < 2) { self.postMessage({results:[]}); return; }
                                const ql = q.toLowerCase();
                                const matches = [];
                                // Only collect top 50
                                for (let [word, def] of Object.entries(dict)) {
                                    const wl = word.toLowerCase();
                                    const dl = def.toLowerCase();
                                    let p = 0;
                                    if (word === q) p = 1;
                                    else if (wl === ql) p = 2;
                                    else if (wl.startsWith(ql)) p = 3;
                                    else if (wl.includes(ql)) p = 4;
                                    else if (dl.includes(ql)) p = 5;
                                    if (p) matches.push({word, def, p});
                                    if (matches.length > 100) break; // Limit early
                                }
                                // Sort: priority, then alphabetically (case preserved)
                                matches.sort((a,b) => a.p - b.p || a.word.localeCompare(b.word, undefined, {sensitivity:'base'}));
                                self.postMessage({ results: matches.slice(0, 50), query: q });
                            }
                        }
                    `], { type: 'application/javascript' }));

                    searchWorker = new Worker(workerCode);
                    searchWorker.onmessage = e => displayResults(e.data.results, e.data.query);
                    searchWorker.postMessage({ type: 'SET', dict: dictionary });

                    // Hide loading, show UI
                    document.getElementById('loadingContainer').style.display = 'none';
                    document.getElementById('searchSection').style.display = 'block';
                    document.getElementById('wordCount').textContent = `Total words: ${Object.keys(dictionary).length.toLocaleString()}`;
                    const input = document.getElementById('searchInput');
                    input.focus();

                    // Instant search on input
                    input.addEventListener('input', e => {
                        const q = e.target.value;
                        if (q.length < 2) {
                            document.getElementById('resultsContainer').innerHTML = '<div class="no-results">Enter at least 2 characters</div>';
                            document.getElementById('searchStatus').textContent = 'Ready to search';
                            return;
                        }
                        document.getElementById('searchStatus').textContent = 'Searching...';
                        // No debounce ‚Äî instant search
                        if (q !== lastQuery) {
                            lastQuery = q;
                            searchWorker.postMessage({ type: 'SEARCH', query: q });
                        }
                    });
                })
                .catch(err => {
                    document.getElementById('loadingContainer').innerHTML = `<div style="color:#f44336">Error: ${err.message}</div>`;
                });
        });

        function displayResults(results, query) {
            const container = document.getElementById('resultsContainer');
            const status = document.getElementById('searchStatus');

            if (results.length === 0) {
                container.innerHTML = `<div class="no-results">No results for "${query}"</div>`;
                status.textContent = 'No results';
                return;
            }

            status.textContent = `Found ${results.length} results`;
            container.innerHTML = results.map(r => `
                <div class="result-item">
                    <div class="word-title">${r.word}</div>
                    <div class="word-definition">${r.def}</div>
                    <div class="edit-controls">
                        <button class="btn btn-web-search" onclick="researchWord('${r.word}')">üåç Research</button>
                        <button class="btn btn-web-search" onclick="enrichWord('${r.word}')">üî¢ Enrich</button>
                    </div>
                </div>
            `).join('');
        }

        function researchWord(term = '') {
            const q = term || document.getElementById('searchInput').value;
            if (!q) return;
            window.open(`https://en.wikipedia.org/wiki/Special:Search?search=${encodeURIComponent(q)}`, '_blank');
        }

        function enrichWord(term = '') {
            const q = term || document.getElementById('searchInput').value;
            if (!q) return;
            window.open(`https://wolframalpha.com/input?i=${encodeURIComponent(q)}`, '_blank');
        }
    </script>
</body>
</html>
